<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SENZAI â€” Strategy Mind Map</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #ffffff; font-family: 'Segoe UI', system-ui, sans-serif; }
        #mindmap { width: 100vw; height: 100vh; }
        svg.markmap { width: 100%; height: 100%; }

        /* Logo overlay â€” update src to your logo file */
        .logo {
            position: fixed;
            top: 16px;
            left: 16px;
            z-index: 10;
            height: 40px;
            opacity: 0.85;
        }

        /* Legend overlay */
        .legend {
            position: fixed;
            bottom: 16px;
            left: 16px;
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(8px);
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 10px 14px;
            font-size: 11px;
            color: #64748b;
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
        .legend span { white-space: nowrap; }

        /* Hint overlay */
        .hint {
            position: fixed;
            top: 16px;
            right: 16px;
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(8px);
            border: 1px solid #e2e8f0;
            border-radius: 10px;
            padding: 8px 14px;
            font-size: 11px;
            color: #94a3b8;
            z-index: 10;
            box-shadow: 0 2px 8px rgba(0,0,0,0.06);
        }
    </style>
</head>
<body>

<!-- Logo: replace src with your SENZAI logo filename -->
<img class="logo" src="senzai-logo-full.png" alt="SENZAI" onerror="this.style.display='none'">

<svg id="mindmap"></svg>

<div class="legend">
    <span>ğŸ“… Timeline</span>
    <span>ğŸ‘¤ Owner</span>
    <span>ğŸ‘¥ Team</span>
    <span>ğŸ¯ Use Case</span>
    <span>ğŸ”„ Migration</span>
    <span>ğŸ›¡ï¸ Governance</span>
    <span>ğŸ“£ GTM</span>
    <span>âš¡ Active</span>
</div>

<div class="hint">Scroll to zoom Â· Drag to pan Â· Click branch to expand</div>

<script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
<script src="https://cdn.jsdelivr.net/npm/markmap-view"></script>
<script src="https://cdn.jsdelivr.net/npm/markmap-lib"></script>
<script>
(async () => {
    const { Transformer } = markmap;
    const { Markmap } = markmap;

    // Load content from external markdown file (easy to edit!)
    const response = await fetch('senzai-content.md?v=' + Date.now());
    const md = await response.text();

    const transformer = new Transformer();
    const { root } = transformer.transform(md);

    // Collapse all level-1 branches so we start with summary view
    function foldBelow(node, level, maxLevel) {
        if (!node.children) return;
        if (level >= maxLevel) {
            node.payload = node.payload || {};
            node.payload.fold = 1;
        }
        node.children.forEach(c => foldBelow(c, level + 1, maxLevel));
    }
    foldBelow(root, 0, 1);

    const mm = Markmap.create('#mindmap', {
        colorFreezeLevel: 2,
        duration: 500,
        maxWidth: 280,
        paddingX: 16,
    }, root);

    setTimeout(() => mm.fit(), 150);

    // One-at-a-time expansion for level-1 branches
    // Intercept in capture phase so we handle BEFORE markmap's own click
    const svg = document.getElementById('mindmap');

    svg.addEventListener('click', (e) => {
        const circle = e.target.closest('circle');
        if (!circle) return;

        const gNode = circle.closest('g.markmap-node');
        if (!gNode || !gNode.__data__) return;

        const hierNode = gNode.__data__;

        // Only intercept level-1 branch circle clicks
        if (hierNode.depth !== 1) return;

        // Prevent markmap from double-toggling
        e.stopPropagation();
        e.preventDefault();

        // Read current state BEFORE we change anything
        const clickedContent = hierNode.data.content;
        const wasOpen = !(hierNode.data.payload && hierNode.data.payload.fold);

        // Fold ALL level-1 branches
        root.children.forEach(c => {
            c.payload = c.payload || {};
            c.payload.fold = 1;
        });

        // If this branch was closed, open it (toggle behavior)
        if (!wasOpen) {
            const match = root.children.find(c => c.content === clickedContent);
            if (match) match.payload.fold = 0;
        }
        // If it was already open, all stay folded â†’ back to summary

        mm.setData(root);
        setTimeout(() => mm.fit(), 300);
    }, true); // capture phase
})();
</script>
</body>
</html>
